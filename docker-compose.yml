# TCG Tracker - Docker Compose
#
# Production (pull from GHCR):
#   IMAGE_TAG=<commit-sha> docker compose up -d
#
# Local development (build locally):
#   docker compose -f docker-compose.yml -f docker-compose.local.yml up
#
# Data is preserved via bind mounts:
#   - Database: ./data/tcg_tracker.db
#   - Pokemon data: ./data/pokemon-tcg-data/

services:
  # Go Backend API (serves frontend static files)
  backend:
    image: ghcr.io/codyseavey/tcg-tracker/app:${IMAGE_TAG:-latest}
    container_name: tcg-backend
    ports:
      - "3080:8080"
    environment:
      - PORT=8080
      - DB_PATH=/app/data/tcg_tracker.db
      - POKEMON_DATA_DIR=/app/data/pokemon-tcg-data
      - FRONTEND_DIST_PATH=/app/frontend/dist
      - GIN_MODE=release
      - JUSTTCG_API_KEY=${JUSTTCG_API_KEY:-}
      - JUSTTCG_DAILY_LIMIT=${JUSTTCG_DAILY_LIMIT:-1000}
      - ADMIN_KEY=${ADMIN_KEY:-}
      - SYNC_TCGPLAYER_IDS_ON_STARTUP=${SYNC_TCGPLAYER_IDS_ON_STARTUP:-true}
      # Gemini API for card identification (required for scanning)
      - GOOGLE_API_KEY=${GOOGLE_API_KEY:-}
    volumes:
      - ./data:/app/data
    restart: always
